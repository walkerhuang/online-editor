<!doctype html>
<head>
<title>Online Coding Editor</title>
<meta charset="utf-8"/>
<link rel="stylesheet" href="lib/codemirror.css">
<link rel="stylesheet" href="addon/fold/foldgutter.css">
<link rel="stylesheet" href="addon/dialog/dialog.css">
<link rel="stylesheet" href="theme/monokai.css">
<link rel="stylesheet" href="css/zTreeStyle.css">
<link href="css/coding.css" rel="stylesheet">
<script src="lib/codemirror.js"></script>
<script src="addon/search/searchcursor.js"></script>
<script src="addon/search/search.js"></script>
<script src="addon/dialog/dialog.js"></script>
<script src="addon/edit/matchbrackets.js"></script>
<script src="addon/edit/closebrackets.js"></script>
<script src="addon/comment/comment.js"></script>
<script src="addon/wrap/hardwrap.js"></script>
<script src="addon/fold/foldcode.js"></script>
<script src="../keymap/sublime.js"></script>
<script src="addon/fold/brace-foldpasswordless.js"></script>
<script src="mode/perl/perl.js"></script>
<script src="js/togetherjs-min.js"></script>
<script src="js/jquery-1.11.1.js"></script>
<script type="text/javascript" src="js/zTree/jquery.ztree.core-3.5.js"></script>
</head>
<h2>Online Coding Editor</h2>
<body>
<button onclick="TogetherJS(this);return false;">Coding Together</button>
<input id="codepath"></input>
<button id="getcode">Load Code</button>
<br/>
<div id="background" class="background" style="display:none"></div>
<div id="loading" style="display:none"></div>
<div class="container">
<div class="left-side">
    <p>Editor</p>
    <div class="nav ztree">
    </div>
    <form id="code_form">
        <textarea id="code" name="code" placeholder="Paste your Code here"></textarea>
        <button type="submit" id = "run_button">Run</button>
    </form>
</div>
<div class="right-side">
    <p>Result</p>
    <div id="result"></div>
</div>
<div class="footer">
    <article>
        <p> "Developed by walker huang. Please contact to walker_huang@symantec.com for any feedback." </p>
    </article>
</div>
</div>
<script>
    var ajaxbg = $("#background");
    var loading = $("#loading");
    $(document).ajaxStart(function() {
        ajaxbg.show();
        $("#loading").show();
    });
    $(document).ajaxStop(function() {
        ajaxbg.hide();
        $("#loading").hide();
    })
    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    lineNumbers: true,
    mode: "perl",
    autoCloseBrackets: true,
    matchBrackets: true,
    showCursorWhenSelecting: true,
    theme: "monokai"
  });
  $('#code_form').submit(function(event){
      event.preventDefault();
      $('#result').empty();
      $('#result').append("<p>Executing the program...");
      $('#result').append("$perl main.pl</p>");
      
      var code = $('textarea').serialize();
      var test;
      $.post("/cgi-bin/passwordless.pl", code, function(response){
          $("#result").append("<font color=green>" + response.val + "</font>");
      });
  });


  var setting = {
      data: {
          simpleData: {
              enable: true
          }
      },

      callback: {
          beforeClick: beforeClick,
          onClick: onClick
      }
  };

  function beforeClick(treeID, treeNode, clickFlag) {
      return (treeNode.click != false);
  }
  function onClick(event, treeID, treeNode, clickFlag) {
      if (!treeNode.isParent) {
          var id = "id=" + treeNode.id;
          $.get("/cgi-bin/show.pl", id, function(response) {
              editor.setValue(response.val);
          });
      }
  }

  $("#getcode").bind("click", function(){
      var path = $('#codepath').val();
      path= "path=" + $('#codepath').val();
      $.post("/cgi-bin/copy_code.pl",path, function(response) {
          var zNodes = response.val;
          $.fn.zTree.init($(".nav"), setting, zNodes);
      })
  });

  </script>

</body>
